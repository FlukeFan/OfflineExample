<!DOCTYPE html>
<html manifest="@(Url.Action<OfflineController>(c => c.Manifest()))">
<head>
    <title>All</title>
    <link rel="shortcut icon" href="@Url.FileContent("~/favicon.ico")" />

    <link rel="stylesheet" href="@Url.FileContent("~/Content/jquery.mobile-1.0.min.css")" />

    @* Add manifested script files to the Manifest class *@
    @foreach(var scriptFile in Manifest.CachedScripts) {
        <script type="text/javascript" src="@Url.FileContent(scriptFile.File)"></script>
    }

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script type="text/javascript">

        var onlinePath = '@Url.FileContent("~/online.txt")';
        var indexPath = '@(Url.Action<OfflineController>(c => c.Index()))';
        var isOnline;

        function doLoad() {

            // replace the current document if it isn't the appropriate start page
            if (window.location.pathname != indexPath)
                window.location.replace(indexPath);

            new OfflineGlobal({
                onlinePath: onlinePath,
            }).init();

        }

        $(document).bind("pagebeforeload", function (e, data) {
            var dataElement = event.srcElement;

            if (!dataElement.tagName)
                return; // it wasn't an HTML element

            while (dataElement.tagName != 'LI')
                dataElement = dataElement.parentNode;

            window.params = dataElement.getAttribute("data-params");
        });

    </script>
</head>
<body>

    @RenderBody()

    <script type="text/javascript">
        $(document).ready(doLoad);
    </script>

</body>
</html>
